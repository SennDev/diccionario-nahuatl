<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diccionario Vivo - Huasteca</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- 1. NUEVA SECCIÓN DE CSS PARA LAS ETIQUETAS --- */
        .tag-container {
            margin-top: 12px;
            margin-bottom: 4px;
        }
        .tag {
            display: inline-block;
            background-color: #e0e7ff; /* Azul muy claro */
            color: #3730a3; /* Azul oscuro */
            padding: 4px 12px;
            border-radius: 9999px; /* Píldora */
            font-size: 0.8rem; /* 13px */
            font-weight: 600;
            margin-right: 6px;
            margin-bottom: 6px;
            text-transform: capitalize; /* Pone la primera letra en mayúscula */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">

    <div class="container mx-auto max-w-2xl p-4">
        
        <header class="text-center my-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                Diccionario Vivo
            </h1>
            <p class="text-xl text-gray-600">Náhuatl de la Huasteca</p>
        </header>

        <div class="mb-6">
            <input 
                type="text" 
                id="search-bar"
                placeholder="Buscar palabra, traducción o categoría..."
                class="w-full p-4 border-2 border-gray-300 rounded-lg shadow-sm text-lg
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
        </div>

        <main id="results-area">
            <div id="loading-spinner"></div>
            <div id="results-container" class="space-y-4">
                </div>
            <div id="no-results" class="text-center text-gray-500 text-lg mt-8 hidden">
                <p>No se encontraron resultados para tu búsqueda.</p>
            </div>
        </main>
        
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const API_URL = 'https://script.google.com/macros/s/AKfycbzo7b4Xt6Un50uv7lRR_r2ldqUiDwKlOCYroXnta8p5n6NEQZ6Q-zmDJ8dajVcBbVQwGA/exec'; // ¡Asegúrate de que esta sea tu URL de API correcta!
        
        let allWords = []; 
        const searchBar = document.getElementById('search-bar');
        const resultsContainer = document.getElementById('results-container');
        const loadingSpinner = document.getElementById('loading-spinner');
        const noResultsMessage = document.getElementById('no-results');

        // --- LÓGICA PRINCIPAL ---
        document.addEventListener('DOMContentLoaded', () => {
            loadingSpinner.style.display = 'block';
            resultsContainer.style.display = 'none';
            noResultsMessage.style.display = 'none';
            fetchWords();
        });

        async function fetchWords() {
            try {
                // ... (el código de fetch sigue igual) ...
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`Error de Red: ${response.statusText}`);
                const data = await response.json();
                if (data.status === 'error') throw new Error(`Error de API: ${data.error}`);

                allWords = data;
                loadingSpinner.style.display = 'none';
                resultsContainer.style.display = 'block';
                renderWords(allWords);

            } catch (error) {
                loadingSpinner.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                        <strong class="font-bold">¡Error!</strong>
                        <span class="block sm:inline">No se pudieron cargar los datos.</span>
                        <p class="text-sm mt-2">Detalle: ${error.message}</p>
                    </div>
                `;
            }
        }

        function renderWords(wordsToRender) {
            resultsContainer.innerHTML = ''; 
            noResultsMessage.style.display = wordsToRender.length === 0 ? 'block' : 'none';

            wordsToRender.forEach(word => {
                const card = document.createElement('div');
                card.className = 'bg-white p-5 rounded-lg shadow-md border border-gray-200 transition-all hover:shadow-lg';
                
                // --- 3. MODIFICACIÓN EN renderWords ---
                //    (La construcción de cardContent ahora incluye createTagBadges)
                
                let cardContent = `
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-2xl font-bold text-blue-700">${word.palabranahuatl}</h2>
                        ${createAudioPlayer(word.audiourl)}
                    </div>
                `;
                
                cardContent += `<p class="text-xl text-gray-700 mb-4">${word.traduccionespanol}</p>`;
                
                // ¡AQUÍ ESTÁ LA MAGIA!
                // Llamamos a la nueva función para crear las etiquetas
                cardContent += createTagBadges(word.categoria);

                if (word.ejemplonahuatl) {
                    cardContent += `
                        <div class="border-t border-gray-200 pt-3 mt-3">
                            <p class="text-md text-gray-600 italic">"${word.ejemplonahuatl}"</p>
                            ${createAudioPlayer(word.audioejemplourl)}
                        </div>
                    `;
                }
                
                card.innerHTML = cardContent;
                resultsContainer.appendChild(card);
            });
        }

        // --- 2. NUEVA FUNCIÓN "HELPER" PARA CREAR ETIQUETAS ---
        /**
         * Crea píldoras HTML (tags) a partir de un string de categorías
         * separado por comas (ej: "sustantivo, animal")
         */
        function createTagBadges(categoriaStr) {
            // Si la celda de 'categoria' está vacía, no devuelve nada
            if (!categoriaStr) {
                return '';
            }

            // Divide el string por comas y quita espacios
            const tags = categoriaStr.split(',').map(tag => tag.trim());
            
            let html = '<div class="tag-container">';
            tags.forEach(tag => {
                // Solo muestra la etiqueta si no está vacía
                if(tag) {
                    html += `<span class="tag">${tag}</span>`;
                }
            });
            html += '</div>';
            return html;
        }

        function createAudioPlayer(url) {
            if (!url) return ''; 
            return `
                <audio controls class="h-8" style="height: 32px;">
                    <source src="${url}" type="audio/mpeg">
                    Tu navegador no soporta el audio.
                </audio>
            `;
        }

        // 4. MODIFICACIÓN EN LA BÚSQUEDA
        //    (Ahora también busca en las categorías)
        searchBar.addEventListener('keyup', () => {
            const query = searchBar.value.toLowerCase().trim();
            
            const filteredWords = allWords.filter(word => {
                const nahuatlMatch = word.palabranahuatl.toLowerCase().includes(query);
                const espanolMatch = word.traduccionespanol.toLowerCase().includes(query);
                
                // ¡NUEVO! Revisa si la categoría también coincide
                const categoriaMatch = word.categoria ? word.categoria.toLowerCase().includes(query) : false;
                
                return nahuatlMatch || espanolMatch || categoriaMatch;
            });

            renderWords(filteredWords);
        });

    </script>
</body>
</html>
